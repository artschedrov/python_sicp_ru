\section{Создание абстракций с помощью функций}
\subsection{Введение}

Компьютерная наука - это чрезвычайно обширная академическая дисциплина. Области глобально распределенных систем, искусственного интеллекта, робототехники, графики, безопасности, научных вычислений, компьютерной архитектуры и десятки развивающихся подобластей каждый год пополняются новыми методами и открытиями. Стремительный прогресс компьютерной науки не затронул практически ни одного аспекта человеческой жизни. Коммерция, коммуникация, наука, искусство, досуг и политика - все они были переосмыслены как компьютерные области.

Огромная производительность компьютерной науки возможна только потому, что она построена на элегантном и мощном наборе фундаментальных идей. Все вычисления начинаются с представления информации, определения логики ее обработки и разработки абстракций, которые управляют сложностью этой логики. Овладение этими основами потребует от нас понимания того, как именно компьютеры интерпретируют компьютерные программы и выполняют вычислительные процессы.

Эти фундаментальные идеи уже давно преподаются в Беркли по классическому учебнику Structure and Interpretation of Computer Programs (\url{https://mitpress.mit.edu/9780262510875/structure-and-interpretation-of-computer-programs/}) Гарольда Абельсона и Джеральда Джея Сассмана с Джули Сассман. Эти конспекты лекций в значительной степени заимствованы из этого учебника, который авторы любезно разрешили адаптировать и использовать повторно.

Начало нашего интеллектуального путешествия не требует пересмотра, и мы не должны ожидать, что он когда-либо понадобится.


\begin{quotation}
Мы собираемся изучить идею вычислительного процесса. Вычислительные процессы - это абстрактные существа, которые населяют компьютеры. По мере своего развития процессы манипулируют другими абстрактными вещами, называемыми данными. Развитие процесса направляется шаблоном правил, называемым программой. Люди создают программы для управления процессами. По сути, мы вызываем духов компьютера с помощью наших заклинаний.

Программы, которые мы используем для управления процессами, похожи на заклинания колдуна. Они тщательно составляются из символических выражений на заумных и эзотерических языках программирования, которые определяют задачи, которые мы хотим, чтобы выполняли наши процессы.

Вычислительный процесс в правильно работающем компьютере выполняет программы точно и аккуратно. Поэтому, подобно ученику колдуна, начинающие программисты должны научиться понимать и предвидеть последствия своих колдовских действий.

-Абельсон и Сассман, SICP (1993)
\end{quotation}

\subsubsection{Программирование на языке Python}
\begin{quotation}
Язык - это не столько то, что вы изучаете, сколько то, к чему вы приобщаетесь.

-Арика Окрент
\end{quotation}

Чтобы определить вычислительные процессы, нам нужен язык программирования, желательно такой, который смогут понять как многие люди, так и множество компьютеров. В этом курсе мы будем изучать язык Python.

Python - это широко распространенный язык программирования, который привлек энтузиастов из многих профессий: веб-программистов, игровых инженеров, ученых, академиков и даже разработчиков новых языков программирования. Изучая Python, вы присоединяетесь к сообществу разработчиков, насчитывающему миллион человек. Сообщества разработчиков - это чрезвычайно важные институты: их члены помогают друг другу решать проблемы, делятся своим кодом и опытом, а также коллективно разрабатывают программное обеспечение и инструменты. Благодаря своему вкладу преданные члены сообщества часто становятся знаменитостями и пользуются всеобщим уважением. Возможно, когда-нибудь и вы окажетесь в числе этих элитных Питонистов.

Сам язык Python - это продукт большого сообщества добровольцев (\url{https://www.python.org/community/}), которое гордится разнообразием своих участников. Язык был задуман и впервые реализован Гвидо ван Россумом (\url{https://en.wikipedia.org/wiki/Guido_van_Rossum}) в конце 1980-х годов. В первой главе его учебника по Python 3 (\url{https://docs.python.org/3/tutorial/appetite.html}) объясняется, почему Python так популярен среди множества существующих сегодня языков.

Python отлично подходит в качестве учебного языка, поскольку на протяжении всей своей истории разработчики Python подчеркивали возможность интерпретации кода Python человеком, что подкреплялось руководящими принципами Zen of Python (\url{https://peps.python.org/pep-0020/}) - красотой, простотой и читабельностью. Python особенно подходит для этого курса, потому что его широкий набор функций поддерживает множество различных стилей программирования, которые мы и будем изучать. Хотя не существует единого способа программирования на Python, есть набор соглашений, разделяемых сообществом разработчиков, которые облегчают процесс чтения, понимания и расширения существующих программ. Таким образом, сочетание гибкости и доступности Python позволяет студентам изучить множество парадигм программирования, а затем применить полученные знания в тысячах текущих проектов (\url{https://pypi.org}).

Эти материалы поддерживают дух SICP, знакомя с особенностями Python в сочетании с методами проектирования абстракций и строгой моделью вычислений. Кроме того, эти материалы содержат практическое введение в программирование на Python, включая некоторые расширенные возможности языка и наглядные примеры. Изучение Python будет происходить естественно по мере прохождения курса.

Однако Python - богатый язык с множеством функций и возможностей, и мы сознательно вводим их постепенно, по мере того как накладываем слой фундаментальных концепций компьютерной науки. Опытным студентам, которые хотят быстро вникнуть во все тонкости языка, мы рекомендуем прочитать книгу Марка Пилгрима "Погружение в Python 3" (\url{https://diveintopython3.net}), которая находится в свободном доступе в Интернете. Темы в этой книге существенно отличаются от тем данного курса, но книга содержит очень ценную практическую информацию по использованию языка Python. Предупреждаем: в отличие от этих материалов, "Погружение в Python 3" предполагает наличие значительного опыта программирования.

Лучший способ начать программировать на Python - это напрямую взаимодействовать с интерпретатором. В этом разделе описано, как установить Python 3, инициировать интерактивный сеанс с интерпретатором и начать программировать.

\subsubsection{Установка Python 3}
Как и любое другое замечательное программное обеспечение, Python имеет множество версий. В этом курсе будет использоваться самая последняя стабильная версия Python 3 (в настоящее время Python 3.2). На многих компьютерах уже установлены более старые версии Python, но они не подойдут для этого курса. Вы можете использовать любой компьютер для этого курса, но вам придется установить Python 3. Не волнуйтесь, Python бесплатен.

В книге Dive Into Python 3 есть подробные инструкции по установке для всех основных платформ (\url{https://diveintopython3.net/installing-python.html}). В этих инструкциях несколько раз упоминается Python 3.1, но вам лучше использовать Python 3.2 (хотя для данного курса различия незначительны). На всех учебных машинах кафедры EECS уже установлен Python 3.2.

\subsubsection{Интерактивные сессии}
В интерактивном сеансе Python вы вводите код Python после подсказки >>>. Интерпретатор Python читает и оценивает то, что вы вводите, выполняя ваши различные команды.

Существует несколько способов начать интерактивную сессию, и они отличаются по своим свойствам. Попробуйте их все, чтобы понять, что вам больше нравится. Все они используют один и тот же интерпретатор за кулисами.
\begin{itemize}
  \item Самый простой и распространенный способ - запустить приложение Python 3. Введите python3 в строке терминала (Mac/Unix/Linux) или откройте приложение Python 3 в Windows.
  \item Более удобное приложение для тех, кто изучает язык, называется IDLE 3 (IDLE3). IDLE раскрашивает ваш код (это называется подсветкой синтаксиса), выводит подсказки по использованию и указывает на источник некоторых ошибок. IDLE всегда поставляется в комплекте с Python, так что вы уже установили его.
  \item Редактор Emacs может запускать интерактивную сессию внутри одного из своих буферов. Хотя изучение Emacs несколько сложнее, это мощный и универсальный редактор для любого языка программирования. Прочитайте учебник 61A по Emacs, чтобы начать работу. Многие программисты, потратившие время на изучение Emacs, больше никогда не переходят на другие редакторы.
\end{itemize}

В любом случае, если вы видите строку интерпретатора Python, >>>, значит, вы успешно начали интерактивный сеанс. В этом примере показан пример взаимодействия с использованием интерпретатора и последующего ввода.

\begin{verbatim}
>>> 2 + 2
4
\end{verbatim}

Элементы управления: В каждом сеансе сохраняется история набранных вами символов. Чтобы получить доступ к этой истории, нажмите <Control>-P (предыдущий) и <Control>-N (следующий). Выход из сеанса <Control>-D удаляет эту историю.

\subsubsection{Первый пример}
\begin{quotation}
И, когда воображение создает

Формы вещей неведомых, и перо поэта

Превращает их в формы и дает воздушному ничто

Местное жилище и имя.

- Уильям Шекспир, "Сон в летнюю ночь".
\end{quotation}

Чтобы ознакомить вас с Python, мы начнем с примера, в котором используются несколько возможностей языка. В следующем разделе нам придется начать с нуля и создавать язык по частям. Воспринимайте этот раздел как предварительный просмотр будущих мощных возможностей.

В Python встроена поддержка широкого спектра распространенных операций программирования, таких как работа с текстом, отображение графики и общение через Интернет.

Оператор импорта

\begin{verbatim}
>>> from urllib.request import urlopen
\end{verbatim}

загружает функциональность для доступа к данным в Интернете. В частности, она делает доступной функцию urlopen, которая может получить доступ к содержимому по унифицированному локатору ресурсов (URL), который представляет собой местоположение чего-либо в Интернете.

Инструкции и выражения. Код Python состоит из инструкций и выражений. В общем случае компьютерные программы состоят из инструкций, направленных либо на:

\begin{enumerate}
  \item Вычислить некоторое значение
  \item Выполнить некоторое действие
\end{enumerate}

Инструкции обычно описывают действия. Когда интерпретатор Python выполняет инструкцию, он выполняет соответствующее действие. С другой стороны, выражения обычно описывают вычисления, которые дают значения. Когда Python вычисляет выражение, он вычисляет его значение. В этой главе мы познакомимся с несколькими типами инструкций и выражений.

Инструкция по присвоению

\begin{verbatim}
>>> shakespeare =
    urlopen('http://inst.eecs.berkeley.edu/~cs61a/fa11/shakespeare.txt')
\end{verbatim}

связывает имя shakespeare со значением выражения, которое следует за ним. Это выражение применяет функцию urlopen к URL-адресу, содержащему полный текст 37 пьес Уильяма Шекспира в одном текстовом документе.

Функции.
В функциях заключена логика, которая манипулирует данными.
Веб-адрес - это часть данных, а текст пьес Шекспира - другая.
Процесс, в результате которого первое приводит ко второму, может быть сложным, но мы можем применить этот процесс, используя лишь простое выражение, потому что эта сложность скрыта в функции.
Функции - основная тема этой главы.

Еще одна инструкция о присвоении

\begin{verbatim}
>>> words = set(shakespeare.read().decode().split())
\end{verbatim}

связывает имя words с набором всех уникальных слов, которые встречаются в пьесах Шекспира, - всего их 33 721. Цепочка команд чтения (read), декодирования (decode) и разбиения (split) оперирует с промежуточным вычислительным объектом: данные считываются из открытого URL, эти данные декодируются в текст, а текст разбивается на слова. Все эти слова помещаются в набор (set).

Объекты. Набор (set) - это тип объекта, который поддерживает такие операции с наборами, как вычисление пересечений и проверка принадлежности. Объект легко объединяет данные и логику, которая манипулирует этими данными, таким образом, чтобы скрыть сложность того и другого. Объекты являются основной темой главы 2.

Выражение

%\begin{lstlisting}
%
%\end{lstlisting}

\begin{verbatim}
>>> {w for w in words if len(w) >= 5 and w[::-1] in words}
{'madam', 'stink', 'leets', 'rever', 'drawer', 'stops', 'sessa',
'repaid', 'speed', 'redder', 'devil', 'minim', 'spots', 'asses',
'refer', 'lived', 'keels', 'diaper', 'sleek', 'steel', 'leper',
'level', 'deeps', 'repel', 'reward', 'knits'}
\end{verbatim}

это составное выражение, которое оценивает набор шекспировских слов, встречающихся как в прямом, так и в обратном порядке. Загадочная нотация w[::-1] перечисляет каждую букву в слове, но -1 говорит о том, что нужно двигаться назад (:: здесь означает, что позиции первого и последнего символов для перечисления заданы по умолчанию). Когда вы вводите выражение в интерактивной сессии, Python печатает его значение в следующей строке, как показано на рисунке.

Интерпретаторы. Вычисление составных выражений требует точной процедуры, которая интерпретирует код предсказуемым образом. Программа, реализующая такую процедуру, вычисляющая составные выражения и утверждения, называется интерпретатором. Проектирование и реализация интерпретаторов - основная тема главы 3.

По сравнению с другими компьютерными программами, интерпретаторы языков программирования уникальны своей общностью. Python не был разработан с расчетом на Шекспира или палиндромы. Однако его большая гибкость позволила нам обработать большой объем текста всего в нескольких строках кода.

В итоге мы увидим, что все эти основные понятия тесно связаны между собой: функции - это объекты, объекты - это функции, а интерпретаторы - это элементы тех и других. Однако четкое понимание каждой из этих концепций и их роли в организации кода имеет решающее значение для овладения искусством программирования.

\subsubsection{Практическое руководство: Ошибки}
Python ждет ваших команд. Вам рекомендуется экспериментировать с языком, даже если вы еще не знаете всего его словарного запаса и структуры. Однако будьте готовы к ошибкам. Хотя компьютеры невероятно быстры и гибки, они также чрезвычайно строги. Природа компьютеров описывается в вводном курсе Стэнфорда следующим образом

\begin{quotation}
Фундаментальное уравнение компьютеров таково: компьютер = мощный + глупый

Компьютеры очень мощные, они быстро обрабатывают большие объемы данных. Компьютеры могут выполнять

миллиарды операций в секунду, причем каждая операция довольно проста.

Компьютеры также потрясающе глупы и уязвимы. Операции, которые они могут выполнять, чрезвычайно строги, просты и механичны. Компьютеру не хватает чего-то похожего на настоящую проницательность... Он совсем не похож на HAL 9000 из фильмов. В любом случае, не стоит пугаться компьютера, как будто это какой-то мозг. Под ним скрывается очень механический аппарат.

Программирование - это когда человек использует свою настоящую интуицию, чтобы построить что-то полезное, сконструированное из этих маленьких, простых операций, которые может выполнять компьютер".

-Франциско Кай и Ник Парланте, Stanford CS101
\end{quotation}

Негибкость компьютеров сразу же станет очевидной, когда вы начнете экспериментировать с интерпретатором Python: даже самые незначительные изменения орфографии и форматирования приведут к неожиданным выводам и ошибкам.

Обучение распознаванию ошибок и диагностике причин неожиданных ошибок называется отладкой. Некоторые руководящие принципы отладки таковы:
\begin{enumerate}
  \item Тестирование пошагово: Каждая хорошо написанная программа состоит из небольших модульных компонентов, которые можно тестировать по отдельности. Тестируйте все, что вы пишете, как можно раньше, чтобы выявить ошибки на ранней стадии и обрести уверенность в своих компонентах.
  \item Изолировать ошибки: Ошибка в выводе составной программы, выражения или утверждения обычно может быть отнесена к определенному модульному компоненту. При попытке диагностировать проблему отследите ошибку до самого маленького фрагмента кода, прежде чем пытаться ее исправить.
  \item Проверка своих предположений: Интерпретаторы выполняют ваши инструкции в точности - не больше и не меньше. Их вывод становится неожиданным, когда поведение некоторого кода не соответствует тому, что считает (или предполагает) программист. Определите свои исходные предположения, а затем сосредоточьте усилия по отладке на проверке того, что ваши предположения действительно соответствуют действительности.
  \item Советоваться с другими: Вы не одиноки! Если вам непонятно сообщение об ошибке, спросите друга, преподавателя или поисковую систему. Если вы обнаружили ошибку, но не можете понять, как ее исправить, попросите кого-нибудь еще посмотреть. Многие ценные знания по программированию передаются в контексте командного решения проблем.
  \end{enumerate}

Поэтапное тестирование, модульное проектирование, точные предположения и работа в команде - темы, которые постоянно присутствуют в этом курсе. Надеемся, что они сохранятся и в вашей карьере в области компьютерных наук.

\subsection{Элементы программирования}
Язык программирования - это не просто средство, с помощью которого компьютер получает инструкции для выполнения задач. Язык также служит каркасом, в котором мы организуем наши идеи о вычислительных процессах. Программы служат для передачи этих идей членам сообщества программистов. Таким образом, программы должны быть написаны для того, чтобы их читали люди, и только потом для того, чтобы их выполняли машины.

Когда мы описываем язык, нам следует обратить особое внимание на средства, которые он предоставляет для объединения простых идей в более сложные. Каждый мощный язык имеет три таких механизма:
\begin{itemize}
  \item Примитивные выражения и операторы, представляющие собой простейшие строительные блоки, которые предоставляет язык
  \item средства комбинирования, с помощью которых сложные элементы создаются из более простых
  \item средства абстракции, с помощью которых составные элементы могут быть названы и управляться как отдельные единицы
  \end{itemize}

В программировании мы имеем дело с двумя видами элементов: функциями и данными. (Неформально данные - это материал, которым мы хотим манипулировать, а функции описывают правила манипулирования данными. Таким образом, любой мощный язык программирования должен уметь описывать примитивные данные и примитивные функции, а также иметь некоторые методы для комбинирования и абстрагирования как функций, так и данных.

\subsubsection{Выражения}
Поэкспериментировав с полноценным интерпретатором Python в предыдущем разделе, мы начинаем заново, методично осваивая язык Python элемент за элементом. Наберитесь терпения, если примеры покажутся вам упрощенными - скоро вас ждет более интересный материал.

Начнем с примитивных выражений. Одним из видов примитивных выражений является число. Точнее, выражение, которое вы вводите, состоит из цифр, обозначающих число по основанию 10.
\begin{verbatim}
  >>> 42
  42
  \end{verbatim}

Выражения, представляющие числа, могут быть объединены с математическими операторами, чтобы сформировать составное выражение, которое интерпретатор будет выполнять:
\begin{verbatim}
>>> -1 - -1
0
>>> 1/2 + 1/4 + 1/8 + 1/16 + 1/32 + 1/64 + 1/128
0.9921875
  \end{verbatim}

В этих математических выражениях используется инфиксная нотация, где оператор (например, +, -, * или /) находится между операндами (числами). В Python существует множество способов формирования составных выражений. Мы не будем пытаться перечислить их все сразу, а будем вводить новые формы выражений по мере продвижения, а также функции языка, которые они поддерживают.

\subsubsection{Вызов выражений}
Наиболее важным видом составного выражения является выражение вызова, которое применяет функцию к некоторым аргументам. Вспомните из алгебры, что математическое понятие функции - это отображение некоторых входных аргументов в выходное значение. Например, функция max сводит свои входящие значения к одному выходящему, которое является наибольшим из входящих. Способ, которым Python выражает применение функций, такой же, как и в обычной математике.
\begin{verbatim}
>>> max(7.5, 9.5)
9.5
  \end{verbatim}

Это выражение вызова имеет подвыражения: оператор - это выражение, стоящее перед круглыми скобками, в которых заключен список выражений-операндов, разделенных запятыми.
\begin{center}
  \includegraphics[scale=1]{call_expression.png}
\end{center}

Оператор задает функцию. Когда это выражение вызова вычисляется, мы говорим, что функция max вызывается с аргументами 7,5 и 9,5 и возвращает значение 9,5.

Порядок аргументов в выражении вызова имеет значение. Например, функция pow возводит первый аргумент в степень значения второго аргумента.
\begin{verbatim}
>>> pow(100, 2)
10000
>>> pow(2, 100)
1267650600228229401496703205376
  \end{verbatim}

Функциональная нотация имеет три основных преимущества перед математической конвенцией инфиксной нотации. Во-первых, функции могут принимать произвольное количество аргументов:
\begin{verbatim}
>>> max(1, -2, 3, -4)
3
  \end{verbatim}

Никакой двусмысленности возникнуть не может, поскольку имя функции всегда предшествует ее аргументам.

Во-вторых, обозначения функций легко распространяются на вложенные выражения, элементы которых сами являются составными выражениями. Во вложенных выражениях вызова, в отличие от составных инфиксных выражений, структура вложенности полностью явна в круглых скобках.
\begin{verbatim}
>>> max(min(1, -2), min(pow(3, 5), -4))
-2
  \end{verbatim}

Глубина такой вложенности и общая сложность выражений, которые может вычислить интерпретатор Python, в принципе не ограничена. Однако люди быстро запутываются в многоуровневой вложенности. Важная роль для вас как программиста - структурировать выражения так, чтобы они оставались интерпретируемыми для вас, ваших партнеров по программированию и других людей, которые могут читать ваши выражения в будущем.

В-третьих, математические обозначения имеют огромное разнообразие форм: умножение отображается между членами, экспоненты - как надстрочные знаки, деление - как горизонтальная полоска, а квадратный корень - как крыша с наклонной черепицей. Некоторые из этих обозначений очень трудно набирать! Однако вся эта сложность может быть унифицирована с помощью нотации выражений вызова. Хотя Python поддерживает общие математические операторы с использованием инфиксной нотации (например, + и -), любой оператор может быть выражен как функция с именем.

\subsubsection{Импорт библиотечных функций}
В Python определено очень большое количество функций, включая функции-операторы, упомянутые в предыдущем разделе, но по умолчанию их имена не доступны, чтобы избежать полного хаоса. Вместо этого язык организует функции и другие объекты, о которых он знает, в модули, которые вместе составляют библиотеку Python. Чтобы использовать эти элементы, нужно их импортировать. Например, модуль math предоставляет множество известных математических функций:
\begin{verbatim}
>>> from math import sqrt, exp
>>> sqrt(256)
16.0
>>> exp(1)
2.718281828459045
  \end{verbatim}

а модуль operator предоставляет доступ к функциям, соответствующим инфиксным операторам:
\begin{verbatim}
>>> from operator import add, sub, mul
>>> add(14, 28)
42
>>> sub(100, mul(7, add(8, 4)))
16
  \end{verbatim}

В операторе import указывается имя модуля (например, operator или math), а затем перечисляются именованные атрибуты этого модуля для импорта (например, sqrt или exp).

В документации по библиотеке Python 3 (\url{https://docs.python.org/3/library/index.html}) перечислены функции, определенные каждым модулем, например, модулем math (\url{https://docs.python.org/3/library/math.html}).
Однако эта документация написана для разработчиков, которые хорошо знают весь язык.
На данный момент вы можете обнаружить, что эксперименты с функцией расскажут вам больше о ее поведении, чем чтение документации.
По мере знакомства с языком и лексикой Python эта документация станет ценным справочным источником.

